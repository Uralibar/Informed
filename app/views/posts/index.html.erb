<% content_for :title, "Posts" %>

<div class="deneme">
  <div class="sort-dropdown" >
    <%= form_with url: posts_path, method: :get, local: true, class: "form-inline" do %>
      <label for="sort" class="mr-2">Sort By:</label>
      <%= select_tag :sort, options_for_select(
        [
          ['Newest', 'newest'],
          ['Oldest', 'oldest'],
          ['Most Upvoted', 'most_upvoted'],
          ['Most Downvoted', 'most_downvoted'],
        ], 
        selected: @sort
      ), 
      class: "form-control", 
      onchange: 'this.form.submit();' %>
    <% end %>
  </div>  
  <h1 class="page-title"  >Posts</h1>
  
</div>


<div class="content-wrapper">
  <div class="top-posts">
    <% if user_signed_in?%>
    <p><strong>Username:</strong> <br><%= link_to current_user.username , user_profile_path(current_user) %></p>
    <div class="d-flex justify-content-between my-3 align-items-center mt-4 px-5">
      <div class="stats">
        <h6 class="mb-0">Followers</h6>
        <span><%= current_user.followers.count %></span>
      </div>
      <div class="stats">
        <h6 class="mb-0">Posts</h6>
        <span><%= current_user.posts.count %></span>
      </div>      
    </div>
    <div class="view-profile-button">
      <%= link_to "View Profile", user_profile_path(current_user), class: "button" %>
    </div><br>
    <p><strong>Biography:</strong><br><%= current_user.biography %></p>
    <% end %>
    <%unless user_signed_in? %>
    <br>
    <%end%>
    <% if user_signed_in? && current_user.agency? %>
      <div>
        <%= link_to "New post", new_post_path, class: "button" %>
    </div>
    <br>
    <p><strong>Joined on:</strong> <%= current_user.created_at.strftime("%B %d, %Y") %></p>  
    <% end %>
  </div>

  <!-- Posts List -->
  <div class="posts-list">
    <% @posts.each do |post| %>
      <div id="posts" class="card w-100 mx-auto">
        <div class="card-body"><br>
          <!-- Display the username before the title -->
          <p><strong>Posted by:</strong> <%= link_to post.user.username, user_profile_path(post.user) %></p>
          <p><strong>Posted:</strong> <%= time_ago_in_words(post.created_at) %> ago</p>
          <h2 class="card-title"><%= post.title %></h2>
          <p class="card-text"><%= post.content %></p>
          
          <!-- Voting Section -->
          <div class="post-voting-index">
            <p>Score: <%= post.score %></p>

            <% current_vote = post.votes.find_by(user: current_user) %>

            <!-- Upvote Button -->
            <% if current_vote&.value == 1 %>
              <%= button_to upvote_post_path(post), method: :post, class: "vote-button" do %>
                <%= image_tag "upvote.png", alt: "Upvote", class: "vote-image" %>
              <% end %>
            <% else %>
              <%= button_to upvote_post_path(post), method: :post, class: "vote-button" do %>
                <%= image_tag "upvote_grey.png", alt: "Upvote", class: "vote-image" %>
              <% end %>
            <% end %>

            <!-- Downvote Button -->
            <% if current_vote&.value == -1 %>
              <%= button_to downvote_post_path(post), method: :post, class: "vote-button" do %>
                <%= image_tag "downvote.png", alt: "Downvote", class: "vote-image" %>
              <% end %>
            <% else %>
              <%= button_to downvote_post_path(post), method: :post, class: "vote-button" do %>
                <%= image_tag "downvote_grey.png", alt: "Downvote", class: "vote-image" %>
              <% end %>
            <% end %>
            <%= link_to "Show this post", post, class: "btn btn-outline-primary btn-sm"%>
          </div>
        </div>
      </div>
      <br>
    <% end %> 
  </div>

  <!-- Top Posts Section -->
  <div class="top-posts">
    <h3>Top 5 Posts</h3>
    <% @top_posts.each do |top_post| %>
      <div class="top-post" style="border: 1px solid #ddd; margin-bottom: 10px; padding: 10px;">
        <h4><%= link_to top_post.title, top_post %></h4>
        <p>Score: <%= top_post.score %></p>
      </div>
    <% end %>
  </div>
</div>
<div class="container mt-4 mb-4 p-3 d-flex justify-content-center"> <div class="card p-4"> <div class=" image d-flex flex-column justify-content-center align-items-center"> <button class="btn btn-secondary"> <img src="https://i.imgur.com/wvxPV9S.png" height="100" width="100" /></button> <span class="name mt-3">Eleanor Pena</span> <span class="idd">@eleanorpena</span> <div class="d-flex flex-row justify-content-center align-items-center gap-2"> <span class="idd1">Oxc4c16a645_b21a</span> <span><i class="fa fa-copy"></i></span> </div> <div class="d-flex flex-row justify-content-center align-items-center mt-3"> <span class="number">1069 <span class="follow">Followers</span></span> </div> <div class=" d-flex mt-2"> <button class="btn1 btn-dark">Edit Profile</button> </div> <div class="text mt-3"> <span>Eleanor Pena is a creator of minimalistic x bold graphics and digital artwork.<br><br> Artist/ Creative Director by Day #NFT minting@ with FND night. </span> </div> <div class="gap-3 mt-3 icons d-flex flex-row justify-content-center align-items-center"> <span><i class="fa fa-twitter"></i></span> <span><i class="fa fa-facebook-f"></i></span> <span><i class="fa fa-instagram"></i></span> <span><i class="fa fa-linkedin"></i></span> </div> <div class=" px-2 rounded mt-4 date "> <span class="join">Joined May,2021</span> </div> </div> </div>
</div>